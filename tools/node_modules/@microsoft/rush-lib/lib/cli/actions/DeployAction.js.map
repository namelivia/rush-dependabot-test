{"version":3,"file":"DeployAction.js","sourceRoot":"","sources":["../../../src/cli/actions/DeployAction.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;AAE3D,oEAAsD;AAGtD,qDAAkD;AAIlD,MAAM,mBAAmB,GAA8B,0BAAM,CAAC,IAAI,CAChE,kCAAkC,EAClC,OAAO,CACR,CAAC;AAEF,MAAa,YAAa,SAAQ,+BAAc;IAO9C,YAAmB,MAA6B;QAC9C,KAAK,CAAC;YACJ,UAAU,EAAE,QAAQ;YACpB,OAAO,EACL,mFAAmF;gBACnF,qBAAqB;YACvB,aAAa,EACX,uFAAuF;gBACvF,qGAAqG;gBACrG,oGAAoG;gBACpG,0DAA0D;YAC5D,MAAM;YAEN,+FAA+F;YAC/F,+BAA+B;YAC/B,gCAAgC,EAAE,IAAI;SACvC,CAAC,CAAC;IACL,CAAC;IAES,kBAAkB;QAC1B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,qBAAqB,CAAC;YACzC,iBAAiB,EAAE,WAAW;YAC9B,kBAAkB,EAAE,IAAI;YACxB,YAAY,EAAE,cAAc;YAC5B,WAAW,EACT,mFAAmF;gBACnF,kEAAkE;SACrE,CAAC,CAAC;QAEH,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,qBAAqB,CAAC;YAC1C,iBAAiB,EAAE,YAAY;YAC/B,kBAAkB,EAAE,IAAI;YACxB,YAAY,EAAE,eAAe;YAC7B,WAAW,EACT,4FAA4F;gBAC5F,6GAA6G;gBAC7G,8GAA8G;SACjH,CAAC,CAAC;QAEH,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,mBAAmB,CAAC;YACzC,iBAAiB,EAAE,aAAa;YAChC,WAAW,EACT,2FAA2F;gBAC3F,kEAAkE;SACrE,CAAC,CAAC;QAEH,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,qBAAqB,CAAC;YAC9C,iBAAiB,EAAE,iBAAiB;YACpC,kBAAkB,EAAE,IAAI;YACxB,YAAY,EAAE,MAAM;YACpB,mBAAmB,EAAE,2BAA2B;YAChD,WAAW,EACT,oFAAoF;gBACpF,uDAAuD;gBACvD,yDAAyD;SAC5D,CAAC,CAAC;QAEH,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,qBAAqB,CAAC;YACnD,iBAAiB,EAAE,kBAAkB;YACrC,YAAY,EAAE,cAAc;YAC5B,WAAW,EACT,qEAAqE;gBACrE,uEAAuE;gBACvE,2FAA2F;gBAC3F,wDAAwD;SAC3D,CAAC,CAAC;IACL,CAAC;IAES,KAAK,CAAC,QAAQ;QACtB,MAAM,aAAa,GAAqC,IAAI,mBAAmB,CAAC,aAAa,CAC3F,IAAI,CAAC,iBAAiB,CACvB,CAAC;QACF,MAAM,aAAa,CAAC,WAAW,CAC7B,IAAI,CAAC,QAAQ,CAAC,KAAK,EACnB,IAAI,CAAC,SAAS,CAAC,KAAK,EACpB,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,EACvB,IAAI,CAAC,aAAa,CAAC,KAAK,EACxB,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAC9B,CAAC;IACJ,CAAC;CACF;AAvFD,oCAuFC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n// See LICENSE in the project root for license information.\n\nimport { Import } from '@rushstack/node-core-library';\nimport { CommandLineFlagParameter, CommandLineStringParameter } from '@rushstack/ts-command-line';\n\nimport { BaseRushAction } from './BaseRushAction';\nimport { RushCommandLineParser } from '../RushCommandLineParser';\n\nimport type * as deployManagerTypes from '../../logic/deploy/DeployManager';\nconst deployManagerModule: typeof deployManagerTypes = Import.lazy(\n  '../../logic/deploy/DeployManager',\n  require\n);\n\nexport class DeployAction extends BaseRushAction {\n  private _scenario!: CommandLineStringParameter;\n  private _project!: CommandLineStringParameter;\n  private _overwrite!: CommandLineFlagParameter;\n  private _targetFolder!: CommandLineStringParameter;\n  private _createArchivePath!: CommandLineStringParameter;\n\n  public constructor(parser: RushCommandLineParser) {\n    super({\n      actionName: 'deploy',\n      summary:\n        'Prepares a deployment by copying a subset of Rush projects and their dependencies' +\n        ' to a target folder',\n      documentation:\n        'After building the repo, \"rush deploy\" can be used to prepare a deployment by copying' +\n        ' a subset of Rush projects and their dependencies to a target folder, which can then be uploaded to' +\n        ' a production server.  The \"rush deploy\" behavior is specified by a scenario config file that must' +\n        ' be created first, using the \"rush init-deploy\" command.',\n      parser,\n\n      // It is okay to invoke multiple instances of \"rush deploy\" simultaneously, if they are writing\n      // to different target folders.\n      safeForSimultaneousRushProcesses: true\n    });\n  }\n\n  protected onDefineParameters(): void {\n    this._project = this.defineStringParameter({\n      parameterLongName: '--project',\n      parameterShortName: '-p',\n      argumentName: 'PROJECT_NAME',\n      description:\n        'Specifies the name of the main Rush project to be deployed. It must appear in the' +\n        ' \"deploymentProjectNames\" setting in the deployment config file.'\n    });\n\n    this._scenario = this.defineStringParameter({\n      parameterLongName: '--scenario',\n      parameterShortName: '-s',\n      argumentName: 'SCENARIO_NAME',\n      description:\n        'By default, the deployment configuration is specified in \"common/config/rush/deploy.json\".' +\n        ' You can use \"--scenario\" to specify an alternate name. The name must be lowercase and separated by dashes.' +\n        ' For example, if SCENARIO_NAME is \"web\", then the config file would be \"common/config/rush/deploy-web.json\".'\n    });\n\n    this._overwrite = this.defineFlagParameter({\n      parameterLongName: '--overwrite',\n      description:\n        'By default, deployment will fail if the target folder is not empty.  SPECIFYING THIS FLAG' +\n        ' WILL RECURSIVELY DELETE EXISTING CONTENTS OF THE TARGET FOLDER.'\n    });\n\n    this._targetFolder = this.defineStringParameter({\n      parameterLongName: '--target-folder',\n      parameterShortName: '-t',\n      argumentName: 'PATH',\n      environmentVariable: 'RUSH_DEPLOY_TARGET_FOLDER',\n      description:\n        'By default, files are deployed to the \"common/deploy\" folder inside the Rush repo.' +\n        ' Use this parameter to specify a different location. ' +\n        ' WARNING: USE CAUTION WHEN COMBINING WITH \"--overwrite\"'\n    });\n\n    this._createArchivePath = this.defineStringParameter({\n      parameterLongName: '--create-archive',\n      argumentName: 'ARCHIVE_PATH',\n      description:\n        'If specified, after the deployment has been prepared, \"rush deploy\"' +\n        ' will create an archive containing the contents of the target folder.' +\n        ' The newly created archive file will be placed according to the designated path, relative' +\n        ' to the target folder. Supported file extensions: .zip'\n    });\n  }\n\n  protected async runAsync(): Promise<void> {\n    const deployManager: deployManagerTypes.DeployManager = new deployManagerModule.DeployManager(\n      this.rushConfiguration\n    );\n    await deployManager.deployAsync(\n      this._project.value,\n      this._scenario.value,\n      !!this._overwrite.value,\n      this._targetFolder.value,\n      this._createArchivePath.value\n    );\n  }\n}\n"]}