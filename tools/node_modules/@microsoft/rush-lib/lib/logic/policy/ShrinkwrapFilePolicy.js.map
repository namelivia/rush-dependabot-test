{"version":3,"file":"ShrinkwrapFilePolicy.js","sourceRoot":"","sources":["../../../src/logic/policy/ShrinkwrapFilePolicy.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;;;;;;;;;;;;;;;;;;;;;;;;AAE3D,uCAAyB;AAKzB,oEAAiE;AAOjE;;GAEG;AACH,MAAa,oBAAoB;IACxB,MAAM,CAAC,QAAQ,CAAC,iBAAoC,EAAE,OAAgC;QAC3F,OAAO,CAAC,GAAG,CAAC,6CAA6C,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;QACpE,MAAM,cAAc,GAAmC,6CAAqB,CAAC,iBAAiB,CAC5F,iBAAiB,CAAC,cAAc,EAChC,iBAAiB,CAAC,qBAAqB,EACvC,iBAAiB,CAAC,8BAA8B,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAC5E,CAAC;QAEF,IAAI,CAAC,cAAc,EAAE;YACnB,OAAO,CAAC,GAAG,CAAC,0DAA0D,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;YACjF,OAAO;SACR;QAED,qCAAqC;QACrC,cAAc,CAAC,QAAQ,CACrB,iBAAiB,CAAC,qBAAqB,kCAElC,OAAO,KACV,SAAS,EAAE,iBAAiB,CAAC,YAAY,CAAC,OAAO,CAAC,iBAAiB,CAAC,KAEtE,iBAAiB,CAAC,wBAAwB,CAAC,aAAa,CACzD,CAAC;IACJ,CAAC;CACF;AAxBD,oDAwBC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n// See LICENSE in the project root for license information.\n\nimport * as os from 'os';\n\nimport { RushConfiguration } from '../../api/RushConfiguration';\nimport { IPolicyValidatorOptions } from './PolicyValidator';\nimport { BaseShrinkwrapFile } from '../base/BaseShrinkwrapFile';\nimport { ShrinkwrapFileFactory } from '../ShrinkwrapFileFactory';\nimport { RepoStateFile } from '../RepoStateFile';\n\nexport interface IShrinkwrapFilePolicyValidatorOptions extends IPolicyValidatorOptions {\n  repoState: RepoStateFile;\n}\n\n/**\n *  A policy that validates shrinkwrap files used by package managers.\n */\nexport class ShrinkwrapFilePolicy {\n  public static validate(rushConfiguration: RushConfiguration, options: IPolicyValidatorOptions): void {\n    console.log('Validating package manager shrinkwrap file.' + os.EOL);\n    const shrinkwrapFile: BaseShrinkwrapFile | undefined = ShrinkwrapFileFactory.getShrinkwrapFile(\n      rushConfiguration.packageManager,\n      rushConfiguration.packageManagerOptions,\n      rushConfiguration.getCommittedShrinkwrapFilename(options.shrinkwrapVariant)\n    );\n\n    if (!shrinkwrapFile) {\n      console.log('Shrinkwrap file could not be found, skipping validation.' + os.EOL);\n      return;\n    }\n\n    // Run shrinkwrap-specific validation\n    shrinkwrapFile.validate(\n      rushConfiguration.packageManagerOptions,\n      {\n        ...options,\n        repoState: rushConfiguration.getRepoState(options.shrinkwrapVariant)\n      },\n      rushConfiguration.experimentsConfiguration.configuration\n    );\n  }\n}\n"]}